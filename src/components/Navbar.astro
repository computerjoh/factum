---
import { Image } from "astro:assets";
import logoImage from "../assets/logo.webp";
import type { NavLink } from "../data/navLinks";

type Props = {
	navLinks?: NavLink[];
	instagramUrl?: string;
	instagramHandle?: string;
};

const {
	navLinks = [],
	instagramUrl = "https://www.instagram.com/factum_performance/",
	instagramHandle = "@factum_performance",
} = Astro.props as Props;
---

<header
	class="sticky top-0 z-40 border-b border-slate-200 bg-white/90 shadow-sm backdrop-blur"
>
	<div
		class="mx-auto flex max-w-6xl items-center justify-between gap-4 px-4 py-3 sm:px-6 lg:px-0"
	>
		<a
			href="/"
			class="flex items-center gap-3 py-3 rounded-full transition hover:opacity-80"
		>
			<Image
				src={logoImage}
				alt="Factum logo"
				width={448}
				height={169}
				class="h-12 w-auto"
			/>
			<div class="block">
				<p class="text-sm font-semibold text-slate-900">Factum</p>
				<p class="text-xs text-slate-500">Performance and Wellness</p>
			</div>
		</a>
		<nav
			class="hidden items-center gap-8 text-sm font-semibold text-slate-700 lg:flex"
		>
			{
				navLinks.map((link) => (
					<a class="transition hover:text-rose-600" href={link.href}>
						{link.label}
					</a>
				))
			}
		</nav>
		<div class="hidden items-center gap-3 lg:flex">
			<a
				href={instagramUrl}
				target="_blank"
				rel="noreferrer"
				class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-900 transition hover:border-rose-500 hover:text-rose-600"
			>
				<svg
					aria-hidden="true"
					class="h-5 w-5 text-rose-600"
					fill="none"
					stroke="currentColor"
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="1.6"
					viewBox="0 0 24 24"
				>
					<path
						d="M8 3.5h8a4.5 4.5 0 0 1 4.5 4.5v8a4.5 4.5 0 0 1-4.5 4.5H8A4.5 4.5 0 0 1 3.5 16V8A4.5 4.5 0 0 1 8 3.5Z"
					></path>
					<circle cx="12" cy="12" r="3.1"></circle>
					<circle cx="17.25" cy="6.75" r="0.75" fill="currentColor"
					></circle>
				</svg>
				<span>{instagramHandle}</span>
			</a>
		</div>
		<button
			type="button"
			class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-2 text-sm font-semibold text-slate-900 transition hover:border-rose-500 hover:text-rose-600 lg:hidden"
			aria-expanded="false"
			aria-controls="mobile-nav"
			data-mobile-toggle
		>
			<span class="sr-only">Toggle navigation</span>
			<span aria-hidden="true" class="flex flex-col items-end gap-1">
				<span class="block h-0.5 w-6 rounded-full bg-current"></span>
				<span class="block h-0.5 w-4 rounded-full bg-current"></span>
				<span class="block h-0.5 w-5 rounded-full bg-current"></span>
			</span>
			<span class="pointer-events-none">Menu</span>
		</button>
	</div>
	<div
		id="mobile-nav"
		data-mobile-panel
		class="hidden border-t border-slate-200 bg-white lg:hidden"
	>
		<nav
			class="mx-auto flex max-w-6xl flex-col gap-1 px-4 py-3 sm:px-6 lg:px-0"
		>
			{
				navLinks.map((link) => (
					<a
						class="rounded-lg px-3 py-2 text-sm font-semibold text-slate-800 transition hover:bg-rose-50 hover:text-rose-700"
						href={link.href}
					>
						{link.label}
					</a>
				))
			}
			<div class="mt-2 flex flex-col gap-2 rounded-xl bg-rose-50 p-3">
				<a
					href={instagramUrl}
					target="_blank"
					rel="noreferrer"
					class="flex items-center justify-center gap-2 rounded-full bg-rose-600 px-4 py-2 text-center text-sm font-semibold text-white transition hover:bg-rose-500"
				>
					<svg
						aria-hidden="true"
						class="h-5 w-5 text-white"
						fill="none"
						stroke="currentColor"
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="1.6"
						viewBox="0 0 24 24"
					>
						<path
							d="M8 3.5h8a4.5 4.5 0 0 1 4.5 4.5v8a4.5 4.5 0 0 1-4.5 4.5H8A4.5 4.5 0 0 1 3.5 16V8A4.5 4.5 0 0 1 8 3.5Z"
						></path>
						<circle cx="12" cy="12" r="3.1"></circle>
						<circle
							cx="17.25"
							cy="6.75"
							r="0.75"
							fill="currentColor"></circle>
					</svg>
					Follow us on Instagram â†—
				</a>
			</div>
		</nav>
	</div>
</header>
<script type="module">
	const toggle = document.querySelector("[data-mobile-toggle]");
	const panel = document.querySelector("[data-mobile-panel]");

	const onEscape = (event) => {
		if (event.key === "Escape") setOpen(false);
	};

	const setOpen = (open) => {
		if (!toggle || !panel) return;
		toggle.setAttribute("aria-expanded", open ? "true" : "false");
		panel.classList.toggle("hidden", !open);
		document.body.classList.toggle("overflow-hidden", open);
		window[open ? "addEventListener" : "removeEventListener"](
			"keyup",
			onEscape,
		);
	};

	toggle?.addEventListener("click", () => {
		const isOpen = toggle.getAttribute("aria-expanded") === "true";
		setOpen(!isOpen);
	});

	panel
		?.querySelectorAll("a")
		?.forEach((link) =>
			link.addEventListener("click", () => setOpen(false)),
		);
</script>
